<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript">
        var jsonObj;
        function viewJSON(what) {
            var URL = what.URL.value;   //take the value from what
            console.log("viewJSON has been activated!");
            function loadJSON (url) {           //Separate function to deal with loadJSOn
                console.log("loadJSON has been activated!");    //DEBUG LOG
                var xmlhttp=new XMLHttpRequest();
                try {
                    xmlhttp.open("GET",url,false); //open, send, responseText are
                    xmlhttp.send(); //properties of XMLHTTPRequest
                    jsonObj=JSON.parse(xmlhttp.responseText);
                }
                catch (err) { //error to catch when the file does not exist
                    console.log("An error has occurred: " + err.message);
                    alert("The requested file does not exist!");
                    return;
                }
                return jsonObj;
            }
            // ....... processing document goes here

            jsonObj = loadJSON(URL);
            jsonObj.onload=generateHTML(jsonObj);
            hWin = window.open("", "Homework2", "height=800,width=1000");
            hWin.document.write(html_text);
            hWin.document.close();
            console.log("Reached the end of viewJSON"); //DEBUG LOG
        }

        function generateHTML(jsonObj){
            root=jsonObj.DocumentElement;   //Obtain the root node
            headerData = jsonObj.Mainline.Table.Header.Data; // create an array of header data from JSON file
            html_text="<html><head><title>Trucking List</title></head><body>";
            html_text+="<table border='2'>";
            html_text+="<tbody>";
            html_text+="<tr>";
            x = 300; y = 150;   //Coordinates 
            
            for (i = 0; i < headerData.length; i++) {           //For loop, create a th with the proper data from headerData
                html_text += "<th>" + headerData[i] + "</th>";
            }

            arrOfCompanies = jsonObj.Mainline.Table.Row;    //Create an array of companies based on the number of rows
            html_text += "</tr>";
            for (i = 0; i < arrOfCompanies.length; i++) {
                company = arrOfCompanies[i];
                html_text += "<tr>";
                var company_keys = Object.keys(company);    //Object.keys(company) returns an array of keys (property names) of each company
                for (j = 0; j < company_keys.length; j++) { //Go through each property based on the company
                    property = company_keys[j]; //Set the property
                    console.log("DEBUG: Getting the property: " + property);
                    if(property == "Logo") {
                        html_text += "<td><img src='" + company[property] + "' width='" + x + "' height='" + y + "'></td>";
                    }
                    else if (property == "HomePage") {
                        html_text += "<td><a href='" + company[property] + "'>" + company[property] + "</a>";
                    }
                    else if (property == "Hubs") {
                        info = company[property].Hub;
                        html_text += "<td><ul>";
                        for (k = 0; k < info.length; k++) {
                            html_text += "<li>" + info[k] + "</li>";
                        }
                        html_text += "</ul></td>";
                    }
                    else {
                        html_text += "<td>" + company[property] + "</td>";
                    }
                }
                    html_text += "</tr>";
                    //End at the end of the for loop, close the newly created table
            }
        }
            html_text += "</tbody>";
            html_text += "</table>";
            html_text += "</body></html>";
        
    </script>
</head>

<body>

    <p style="text-align: center;">
        <B>Enter URL for Trucking List JSON File</B><br><br>
        <form name="myform" method="POST" id="location">
            <!--<input id="file" type="text"><br><br>-->
            <input type="text" name="URL" maxlength="255" value="truckinglist.json"><br><br>
            <input type="button" name="submit" value="Submit Query" onClick="viewJSON(this.form)">
        </form>
    </p>
</body>

</html>